---
import { getThemesForLang } from "@/config/themes";
import { siteConfig } from "@/site.config";
import { getLang } from "@/utils/i18n";

// Get current language from site config
const lang = getLang(siteConfig.lang);
const themesForLang = getThemesForLang(lang);

// i18n labels
const labels = {
	en: { style: 'Style:' },
	pl: { style: 'Styl:' },
};
---

<div class="theme-switcher">
	<label for="theme-select" class="theme-switcher__label">
		{labels[lang].style}
	</label>
	<select id="theme-select" class="theme-switcher__select">
		{themesForLang.map((theme) => (
			<option value={theme.id}>{theme.label}</option>
		))}
	</select>
</div>

<script>
	const THEME_KEY = 'site-style-theme';

	function getStoredTheme(): string {
		return localStorage.getItem(THEME_KEY) || 'default';
	}

	function setStoredTheme(theme: string): void {
		localStorage.setItem(THEME_KEY, theme);
	}

	function applyTheme(theme: string): void {
		document.documentElement.setAttribute('data-style-theme', theme);
	}

	// Initialize theme on page load
	const storedTheme = getStoredTheme();
	applyTheme(storedTheme);

	// Set select value to stored theme
	const selectElement = document.getElementById('theme-select') as HTMLSelectElement;
	if (selectElement) {
		selectElement.value = storedTheme;

		// Handle theme change
		selectElement.addEventListener('change', (e) => {
			const target = e.target as HTMLSelectElement;
			const newTheme = target.value;
			applyTheme(newTheme);
			setStoredTheme(newTheme);
		});
	}

	// Apply theme on navigation (for view transitions)
	document.addEventListener('astro:page-load', () => {
		const currentTheme = getStoredTheme();
		applyTheme(currentTheme);
		
		const select = document.getElementById('theme-select') as HTMLSelectElement;
		if (select) {
			select.value = currentTheme;
		}
	});
</script>
