---
import { Image } from "astro:assets";
import type { WebmentionsChildren } from "@/types";

interface Props {
  mentions: WebmentionsChildren[];
}

const { mentions } = Astro.props;
const MAX_LIKES = 10;

const likes = mentions.filter(
  (mention) => mention["wm-property"] === "like-of",
);
const likesToShow = likes
  .filter((like) => like.author?.photo && like.author.photo !== "")
  .slice(0, MAX_LIKES);
---

{
  !!likes.length && (
    <div>
      <p class="count">
        <strong>{likes.length}</strong>
        {likes.length > 1 ? " People" : " Person"} liked this
      </p>
      {!!likesToShow.length && (
        <ul class="list" role="list">
          {likesToShow.map((like) => (
            <li class="item p-like h-cite">
              <a
                class="link u-url"
                href={like.author?.url}
                rel="noreferrer"
                target="_blank"
                title={like.author?.name}
              >
                <span class="p-author h-card">
                  <Image
                    alt={like.author!.name}
                    class="avatar u-photo"
                    height={48}
                    src={like.author!.photo}
                    width={48}
                  />
                </span>
              </a>
            </li>
          ))}
        </ul>
      )}
    </div>
  )
}

<style>
  .count {
    margin-block-end: 0;
    color: var(--color-accent-2);
  }

  .list {
    display: flex;
    flex-wrap: wrap;
    margin: 0;
    padding-inline-start: var(--space-xs);
    overflow: hidden;
    list-style: none;
  }

  .item {
    margin-inline-start: -0.5rem;
  }

  .link {
    position: relative;
    display: inline-block;
    overflow: hidden;
    border-radius: 9999px;
    box-shadow: 0 0 0 2px var(--color-text);
    transition: all 0.2s ease;

    &:hover,
    &:focus-visible {
      z-index: 10;
      box-shadow: 0 0 0 4px var(--color-link);
    }
  }

  .avatar {
    display: inline-block;
    inline-size: 3rem;
    block-size: 3rem;
    margin-block: 0;
  }
</style>
