---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "@/components/FormattedDate.astro";
import type { HTMLTag, Polymorphic } from "astro/types";

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
  post: CollectionEntry<"post"> | CollectionEntry<"artykul">;
  withArrow?: boolean;
};

const { as: Tag = "div", post, withArrow = false } = Astro.props;

const basePath = post.collection === "artykul" ? "/artykuly/" : "/posts/";
const slug = post.id.split("/").pop();
const postUrl = `${basePath}${slug}/`;
---

<a
  class:list={["preview", { "preview--with-arrow": withArrow }]}
  href={postUrl}
>
  <FormattedDate class="date text--dimmed" date={post.data.publishDate} />
  <div class="main">
    <Tag class="title">
      {post.data.draft && <span class="draft-label">(Draft) </span>}
      {post.data.title}
    </Tag>
    {
      withArrow && (
        <svg
          class="arrow"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          aria-hidden="true"
        >
          <path
            d="M9 5L16 12L9 19"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      )
    }
  </div>
</a>

<style>
  .preview {
    display: block;
    color: inherit;
    text-decoration: none;
  }

  .preview--with-arrow {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    padding-block: var(--space-sm);

    @media (min-width: 40rem) {
      display: grid;
      column-gap: var(--space-sm);
      grid-template-columns: repeat(12, 1fr);
    }
  }

  .preview :global(.date) {
    @media (min-width: 40rem) {
      grid-column: 1 / 4;
    }
  }

  :global(html[data-theme="dark"]) .preview :global(.date) {
    color: var(--color-gray-400);
  }

  .main {
    display: flex;
    justify-content: space-between;
    gap: 1.5rem;

    @media (min-width: 40rem) {
      grid-column: 5 / 13;
    }
  }

  .arrow {
    flex-shrink: 0;
    inline-size: 1.5rem;
    block-size: 1.5rem;
    color: var(--color-gray-400);
    transition:
      transform 0.2s ease,
      color 0.2s ease;
  }

  .preview:hover .arrow {
    color: var(--color-text);
    transform: translateX(4px);
  }

  .draft-label {
    color: var(--color-red-500);
  }
</style>
